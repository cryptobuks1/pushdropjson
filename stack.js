//TODO: extract stack logic here